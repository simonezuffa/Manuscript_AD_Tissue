Sys.getenv("CC")
Sys.setenv(CC = "/opt/homebrew/bin/gfortran")
> Sys.getenv("CC")
Sys.setenv(CC = "/opt/homebrew/bin/gfortran")
Sys.getenv("CC")
devtools::install_github("pmartR/pmartR@*release")
devtools::install_github("ricoderks/Rcpm")
library(pacman)
pacman::p_load(c("impute", "pcaMethods", "globaltest", "GlobalAncova", "Rgraphviz", "preprocessCore", "genefilter", "sva", "limma", "KEGGgraph", "siggenes","BiocParallel", "MSnbase", "multtest","RBGL","edgeR","fgsea","httr","qs"))
devtools::install_github("xia-lab/MetaboAnalystR", build = TRUE, build_vignettes = TRUE, build_manual =T)
BiocManager::install("RBGL")
BiocManager::install("fgsea")
BiocManager::install("siggenes")
devtools::install_github("xia-lab/MetaboAnalystR", build = TRUE, build_vignettes = TRUE, build_manual =T)
install.packages(c("bslib", "cluster", "crosstalk", "deldir", "diptest", "dplyr", "GGally", "gtools", "htmlwidgets", "insight", "interp", "jqr", "Matrix", "MatrixModels", "mclust", "mvtnorm", "nlme", "pls", "PMCMRplus", "R.utils", "Rfast", "shiny", "sodium", "sp", "stringi", "stringr", "tinytex"))
install.packages(c("bslib", "Cairo", "cluster", "deSolve", "expm", "foreign", "gmp", "interp", "mvtnorm", "ncdf4", "nlme", "qs", "rgl", "robustbase", "Rserve", "scales", "stringfish", "units", "wk", "XML"))
install.packages(c("checkmate", "cluster", "cpp11", "gert", "jqr", "jsonlite", "RcppArmadillo", "Rmpfr", "testthat", "vctrs", "xml2"))
install.packages(c("gert", "jqr", "Rmpfr"))
sixmix_fix_feature_info
install.packages("omicsTools")
devtools::install_github("pmartR/pmartR@*release")
install.packages(c("brew", "brio", "cli", "cowplot", "curl", "data.table", "datawizard", "DBI", "desc", "DiceDesign", "DT", "e1071", "emmeans", "fansi", "filelock", "future", "future.apply", "gdtools", "ggeffects", "ggside", "htmlwidgets", "httpuv", "igraph", "later", "maps", "markdown", "matrixStats", "mgcv", "pcaPP", "pkgbuild", "PMCMRplus", "processx", "progress", "qs", "ragg", "rayimage", "rayrender", "rayvertex", "recipes", "rnaturalearth", "rpart", "RSQLite", "Rtsne", "s2", "sass", "sf", "stringi", "svglite", "tensorA", "terra", "tidygraph", "timeDate", "vipor", "vroom", "xgboost", "yaml", "zCompositions"))
install.packages(c("brew", "brio", "cli", "cowplot", "curl", "data.table", "datawizard", "DBI", "desc", "DiceDesign", "DT", "e1071", "emmeans", "fansi", "filelock", "future", "future.apply", "gdtools", "ggeffects", "ggside", "htmlwidgets", "httpuv", "igraph", "later", "maps", "markdown", "matrixStats", "mgcv", "pcaPP", "pkgbuild", "PMCMRplus", "processx", "progress", "qs", "ragg", "rayimage", "rayrender", "rayvertex", "recipes", "rnaturalearth", "rpart", "RSQLite", "Rtsne", "s2", "sass", "sf", "stringi", "svglite", "tensorA", "terra", "tidygraph", "timeDate", "vipor", "vroom", "xgboost", "yaml", "zCompositions"))
install.packages(c("brew", "brio", "cli", "cowplot", "curl", "data.table", "datawizard", "DBI", "desc", "DiceDesign", "DT", "e1071", "emmeans", "fansi", "filelock", "future", "future.apply", "gdtools", "ggeffects", "ggside", "htmlwidgets", "httpuv", "igraph", "later", "maps", "markdown", "matrixStats", "mgcv", "pcaPP", "pkgbuild", "PMCMRplus", "processx", "progress", "qs", "ragg", "rayimage", "rayrender", "rayvertex", "recipes", "rnaturalearth", "rpart", "RSQLite", "Rtsne", "s2", "sass", "sf", "stringi", "svglite", "tensorA", "terra", "tidygraph", "timeDate", "vipor", "vroom", "xgboost", "yaml", "zCompositions"))
install.packages(c("brew", "brio", "cli", "cowplot", "curl", "data.table", "datawizard", "DBI", "desc", "DiceDesign", "DT", "e1071", "emmeans", "fansi", "filelock", "future", "future.apply", "gdtools", "ggeffects", "ggside", "htmlwidgets", "httpuv", "igraph", "later", "maps", "markdown", "matrixStats", "mgcv", "pcaPP", "pkgbuild", "PMCMRplus", "processx", "progress", "qs", "ragg", "rayimage", "rayrender", "rayvertex", "recipes", "rnaturalearth", "rpart", "RSQLite", "Rtsne", "s2", "sass", "sf", "stringi", "svglite", "tensorA", "terra", "tidygraph", "timeDate", "vipor", "vroom", "xgboost", "yaml", "zCompositions"))
install.packages(c("castor", "compositions", "patchwork", "phytools", "Rcpp", "RCurl", "zCompositions"))
install.packages("compositions")
install.packages(c("BH", "compositions", "DBI", "digest", "expm", "gbm", "ggrepel", "ggstatsplot", "glue", "gmp", "graphlayouts", "MASS", "Matrix", "pkgload", "plotly", "ps", "readr", "reprex", "rlang", "roxygen2", "statsExpressions", "timechange", "uuid", "withr", "yardstick"))
install.packages(c("BayesFactor", "bs4Dash", "cowplot", "emmeans", "hoardr", "MALDIquant", "R.oo", "roxygen2", "tidyr"))
remotes::install_github("kevinmildau/homologueDiscoverer")
install.packages("MassTools")
remotes::install_github("tidymass/masstools")
remotes::install_github("kevinmildau/homologueDiscoverer")
remotes::install_github("mjhelf/MassTools")
remotes::install_github("kevinmildau/homologueDiscoverer")
install.packages("xgboost")
install.packages(c("gdtools", "ggplot2", "mclust", "shape"))
install.packages(c("afex", "bookdown", "boot", "curl", "data.table", "deldir", "gdtools", "ggeffects", "ggraph", "ggsci", "ggside", "hrbrthemes", "lava", "locfit", "officer", "parallelly", "prettymapr", "RcppArmadillo", "RcppEigen", "renv", "rgl", "rmarkdown", "tweenr"))
install.packages(c("ggraph", "santaR", "systemfonts"))
install.packages(c("digest", "globals", "graphlayouts", "multcompView", "qs", "tidyselect", "zCompositions"))
install.packages(c("ggsci", "Hmisc", "igraph", "insight", "parameters", "pkgbuild", "processx", "ragg", "remotes", "sass", "tinytex", "WRS2", "zCompositions"))
install.packages(c("broom.helpers", "broom.mixed", "bslib", "codetools", "data.table", "datawizard", "DT", "effectsize", "future", "future.apply", "ggeffects", "ggstats", "gh", "htmltools", "httpuv", "httr2", "infer", "lme4", "munsell", "promises", "RcppArmadillo", "RSQLite", "shiny", "tidymodels", "WikipediR"))
install.packages(c("emmeans", "ggstatsplot", "knitr", "RcppArmadillo"))
install.packages(c("lme4", "RcppArmadillo"))
install.packages(c("ggfortify", "ggplot2", "gtable", "labelled", "openssl", "pkgdown", "survival", "tune"))
install.packages(c("brio", "fs", "xopen"))
install.packages(c("mclust", "pixmap", "sp"))
install.packages(c("BiocManager", "officer", "ragg", "RcppArmadillo", "stringi", "tinytex"))
install.packages(c("backports", "broom", "cachem", "effectsize", "emmeans", "estimability", "farver", "fastmap", "ggeffects", "ggsci", "highr", "Hmisc", "insight", "KernSmooth", "minqa", "mvtnorm", "openssl", "parameters", "qs", "quantreg", "ragg", "RApiSerialize", "RcppArmadillo", "rmarkdown", "RSQLite", "sjmisc", "sjPlot", "sjstats", "spacefillr", "SparseM", "systemfonts", "terra", "textshaping", "vegan", "xfun"))
install.packages(c("Hmisc", "qs"))
install.packages(c("DBI", "hardhat", "Hmisc", "qs", "RcppArmadillo", "SparseM"))
install.packages(c("correlation", "datawizard", "downlit", "evaluate", "Hmisc", "insight", "markdown", "mc2d", "nlme", "performance", "phytools", "qs", "RcppArmadillo", "rlang", "SparseM", "survival", "waveslim"))
install.packages(c("nlme", "nloptr", "qs", "RcppArmadillo", "robustbase", "SparseM"))
install.packages(c("bookdown", "effectsize", "lme4", "nlme", "nloptr", "ps", "qs", "RcppArmadillo", "recipes", "robustbase", "SparseM", "statsExpressions", "yaml"))
install.packages(c("nlme", "nloptr", "qs", "RcppArmadillo", "robustbase", "SparseM"))
install.packages(c("ggstatsplot", "knitr", "nlme", "nloptr", "pkgdown", "qs", "RcppArmadillo", "RcppParallel", "reprex", "robustbase", "SparseM"))
install.packages(c("nlme", "nloptr", "qs", "RcppArmadillo", "robustbase", "SparseM", "wk"))
install.packages(c("cubature", "datawizard", "httr2", "insight", "nlme", "nloptr", "performance", "qs", "rayimage", "Rcpp", "RcppArmadillo", "robustbase", "s2", "SparseM"))
install.packages(c("clock", "ipred", "nlme", "nloptr", "performance", "qs", "RcppArmadillo", "robustbase", "RSpectra", "s2", "SparseM", "tinytex", "xfun"))
install.packages(c("crul", "datawizard", "gert", "htmlTable", "nlme", "nloptr", "parameters", "qs", "rayvertex", "RcppArmadillo", "robustbase", "RSpectra", "s2", "SparseM"))
install.packages(c("bayestestR", "colorspace", "gert", "nlme", "nloptr", "polyclip", "qs", "RcppArmadillo", "robustbase", "RSpectra", "s2", "SparseM", "xgboost", "yaml"))
install.packages(c("bitops", "bslib", "checkmate", "future", "gert", "nlme", "nloptr", "parallelly", "qs", "rayrender", "RcppArmadillo", "robustbase", "RSpectra", "s2", "SparseM", "usethis", "uuid"))
install.packages(c("dials", "gert", "nlme", "nloptr", "pls", "qs", "rayrender", "RcppArmadillo", "robustbase", "RSpectra", "s2", "shiny", "SparseM", "withr"))
install.packages(c("gert", "nlme", "nloptr", "qs", "RcppArmadillo", "robustbase", "RSpectra", "s2", "SparseM"))
install.packages(c("gert", "nlme", "nloptr", "pcaPP", "qs", "RcppArmadillo", "robustbase", "RSpectra", "s2", "SparseM"))
install.packages(c("corrplot", "digest", "expm", "fastDummies", "fBasics", "gert", "golem", "insight", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "qs", "RcppArmadillo", "RcppEigen", "rmarkdown", "robustbase", "rrcov", "RSpectra", "s2", "SparseM", "stabledist", "xfun"))
install.packages(c("BiocManager", "boot", "broom.helpers", "cpp11", "curl", "data.table", "emmeans", "EnvStats", "expm", "fBasics", "gdtools", "gert", "gmp", "golem", "httr2", "jqr", "jtools", "MALDIquant", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "qs", "RANN", "RcppArmadillo", "RcppEigen", "RcppParallel", "robustbase", "rrcov", "RSpectra", "s2", "shapviz", "SparseM", "taxize", "vegan", "waldo"))
install.packages(c("expm", "fBasics", "gdtools", "gert", "gmp", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "qs", "RcppArmadillo", "RcppEigen", "robustbase", "rrcov", "RSpectra", "s2", "SparseM", "vegan"))
install.packages(c("afex", "bs4Dash", "cards", "datawizard", "expm", "fBasics", "gdtools", "gert", "ggeffects", "gmp", "insight", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "performance", "qs", "RcppArmadillo", "RcppEigen", "robustbase", "rrcov", "RSpectra", "s2", "SparseM", "SuppDists", "vegan"))
install.packages(c("abind", "bit", "bit64", "bitops", "broom", "car", "cards", "caTools", "curl", "Deriv", "e1071", "evaluate", "expm", "fBasics", "gdtools", "gert", "ggrepel", "ggstats", "glue", "gmp", "graphlayouts", "hexbin", "httr2", "insight", "jqr", "jsonlite", "matrixStats", "microbenchmark", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "parameters", "patchwork", "pcaPP", "phangorn", "pkgdown", "pls", "PMCMRplus", "profvis", "ps", "qs", "ragg", "randomForest", "RApiSerialize", "raster", "RcppArmadillo", "RcppEigen", "renv", "reticulate", "rjson", "robustbase", "rrcov", "RSpectra", "rsvg", "s2", "sandwich", "sf", "shapviz", "SparseM", "statsExpressions", "timeDate", "timeSeries", "tinytex", "vegan", "wk", "xfun"))
install.packages(c("askpass", "commonmark", "credentials", "expm", "fBasics", "gdtools", "gert", "gmp", "hexbin", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "phangorn", "PMCMRplus", "qs", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "robustbase", "rrcov", "RSpectra", "rsvg", "s2", "sf", "sodium", "SparseM", "sys", "vegan"))
install.packages(c("datawizard", "expm", "fBasics", "gdtools", "gert", "gmp", "gplots", "hexbin", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "phangorn", "PMCMRplus", "qs", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "renv", "robustbase", "rrcov", "RSpectra", "rsvg", "s2", "sf", "sodium", "SparseM", "vegan"))
install.packages(c("bayestestR", "bookdown", "broom.mixed", "corrplot", "data.table", "doBy", "emmeans", "evaluate", "expm", "fBasics", "gdtools", "gert", "ggeffects", "gmp", "gss", "hexbin", "jqr", "minqa", "modelenv", "mvtnorm", "ncdf4", "nlme", "nloptr", "officer", "openssl", "parameters", "pcaPP", "performance", "phangorn", "PMCMRplus", "qs", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "renv", "robustbase", "rrcov", "RSpectra", "rstudioapi", "rsvg", "s2", "sf", "shapviz", "sodium", "SparseM", "terra", "vegan", "wk"))
# Load required libraries
library(tidymodels)
library(tidyverse)
library(ranger)
library(vip)
library(SHAPforxgboost)
# Set seed for reproducibility
set.seed(42)
# Function to create train-test split and preprocessing
create_splits <- function(data, target_col, split_prop = 0.8) {
# Create the initial split
initial_split <- initial_split(data, prop = split_prop, strata = !!sym(target_col))
# Create the training and testing sets
train_data <- training(initial_split)
test_data <- testing(initial_split)
# Create cross-validation folds
cv_folds <- vfold_cv(train_data, v = 5, strata = !!sym(target_col))
# Create the recipe
model_recipe <- recipe(formula = as.formula(paste(target_col, "~ .")),
data = train_data) %>%
step_normalize(all_predictors()) %>%
step_zv(all_predictors())
return(list(
train_data = train_data,
test_data = test_data,
cv_folds = cv_folds,
recipe = model_recipe
))
}
# Function to define model specification and workflow
create_rf_workflow <- function() {
# Define the model specification
rf_spec <- rand_forest(
mtry = tune(),
trees = tune(),
min_n = tune()
) %>%
set_engine("ranger", importance = "permutation") %>%
set_mode("classification")
# Create the workflow
rf_workflow <- workflow() %>%
add_model(rf_spec)
return(rf_workflow)
}
# Function to perform hyperparameter tuning
tune_rf_model <- function(workflow, recipe, cv_folds) {
# Define the parameter grid
rf_grid <- grid_random(
mtry() %>% range_set(c(3, 8)),
trees() %>% range_set(c(100, 1000)),
min_n() %>% range_set(c(2, 10)),
size = 30
)
# Add recipe to workflow
workflow <- workflow %>%
add_recipe(recipe)
# Tune the model
rf_tuning <- workflow %>%
tune_grid(
resamples = cv_folds,
grid = rf_grid,
metrics = metric_set(accuracy, roc_auc, precision, recall),
control = control_grid(save_pred = TRUE)
)
return(rf_tuning)
}
# Function to analyze tuning results
analyze_tuning_results <- function(tuning_results) {
# Show best results
best_results <- tuning_results %>%
show_best(metric = "accuracy", n = 5)
print("Top 5 models by accuracy:")
print(best_results)
# Create visualization of parameter impact
tuning_results %>%
collect_metrics() %>%
filter(.metric == "accuracy") %>%
select(mean, mtry, trees, min_n) %>%
pivot_longer(cols = c(mtry, trees, min_n),
names_to = "parameter",
values_to = "value") %>%
ggplot(aes(value, mean)) +
geom_point(alpha = 0.5) +
facet_wrap(~parameter, scales = "free_x") +
labs(x = "Parameter Value", y = "Mean Accuracy") +
theme_bw()
return(best_results)
}
# Function to finalize model with best parameters
finalize_model <- function(workflow, tuning_results, train_data) {
# Get best parameters
best_params <- tuning_results %>%
select_best(metric = "accuracy")
# Finalize workflow
final_workflow <- workflow %>%
finalize_workflow(best_params)
# Fit the final model
final_model <- final_workflow %>%
fit(data = train_data)
return(final_model)
}
# Function to evaluate model performance
evaluate_model <- function(final_model, test_data, target_col) {
# Make predictions
predictions <- predict(final_model, test_data) %>%
bind_cols(test_data)
# Calculate metrics
metrics <- predictions %>%
metrics(truth = !!sym(target_col), estimate = .pred_class)
# Create confusion matrix
conf_mat <- predictions %>%
conf_mat(truth = !!sym(target_col), estimate = .pred_class)
# Plot confusion matrix
conf_mat %>%
autoplot(type = "heatmap")
return(list(
metrics = metrics,
conf_mat = conf_mat
))
}
# Function to analyze feature importance
analyze_feature_importance <- function(final_model, train_data) {
# Extract feature importance
importance <- final_model %>%
extract_fit_parsnip() %>%
vip(num_features = 20)
# Plot feature importance
print(importance)
# Calculate SHAP values (if possible with the data)
# Note: This requires the data to be in the correct format
tryCatch({
model_fit <- final_model %>%
extract_fit_engine()
# Prepare data for SHAP calculation
pred_data <- train_data %>%
select(-target) %>%
as.matrix()
shap_values <- ranger.unify(model_fit, pred_data)
# Plot SHAP summary
shap.plot.summary(shap_values)
}, error = function(e) {
message("Could not calculate SHAP values. This might be due to data format issues.")
})
return(importance)
}
# Main execution function
run_rf_analysis <- function(data, target_col) {
# Split data and create recipe
splits <- create_splits(data, target_col)
# Create workflow
rf_workflow <- create_rf_workflow()
# Tune model
tuning_results <- tune_rf_model(rf_workflow, splits$recipe, splits$cv_folds)
# Analyze tuning results
best_results <- analyze_tuning_results(tuning_results)
# Finalize model
final_model <- finalize_model(rf_workflow, tuning_results, splits$train_data)
# Evaluate model
evaluation <- evaluate_model(final_model, splits$test_data, target_col)
# Analyze feature importance
importance <- analyze_feature_importance(final_model, splits$train_data)
return(list(
model = final_model,
evaluation = evaluation,
importance = importance,
tuning_results = tuning_results
))
}
# Example with built-in dataset
data(iris)
results <- run_rf_analysis(iris, "Species")
install.packages(c("correlation", "expm", "fBasics", "fs", "future.apply", "gdata", "gdtools", "gert", "ggstatsplot", "gmp", "googlePolylines", "gss", "gtable", "hexbin", "Hmisc", "httr2", "igraph", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "pcaPP", "phangorn", "pkgbuild", "PMCMRplus", "progressr", "ps", "qs", "quantreg", "R.oo", "ragg", "randomForest", "Rcpp", "RcppArmadillo", "RcppEigen", "rgl", "rmarkdown", "robustbase", "rrcov", "RSpectra", "rstudioapi", "rsvg", "sf", "slider", "sodium", "SparseM", "statsExpressions", "terra", "tinytex", "vdiffr", "vegan", "waldo", "withr", "xfun"))
install.packages(c("castor", "clue", "curl", "expm", "fBasics", "fontawesome", "gdtools", "gert", "gmp", "graphlayouts", "gss", "hexbin", "Hmisc", "igraph", "inline", "jqr", "knitr", "maps", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "parallelly", "pcaPP", "phangorn", "PMCMRplus", "qs", "quantreg", "ragg", "randomForest", "ranger", "RcppArmadillo", "RcppEigen", "reticulate", "rgl", "Rmpfr", "robustbase", "rrcov", "RSpectra", "RSQLite", "rsvg", "sf", "sodium", "SparseM", "terra", "vdiffr", "vegan", "waldo"))
install.packages(c("DEoptimR", "expm", "fBasics", "gdtools", "gert", "gmp", "gss", "hexbin", "Hmisc", "igraph", "insight", "jqr", "later", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "pcaPP", "phangorn", "PMCMRplus", "progressr", "promises", "qs", "quantreg", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "Rmpfr", "robustbase", "rrcov", "RSpectra", "rsvg", "sf", "sodium", "SparseM", "terra", "usethis", "vdiffr", "vegan"))
install.packages(c("bit", "cards", "expm", "fBasics", "gdtools", "gert", "ggeffects", "gmp", "gss", "hexbin", "Hmisc", "httr2", "igraph", "jqr", "later", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "parallelly", "parameters", "pcaPP", "phangorn", "PMCMRplus", "promises", "qs", "quantreg", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "Rmpfr", "robustbase", "rrcov", "RSpectra", "RSQLite", "rsvg", "sf", "sjPlot", "sodium", "SparseM", "terra", "vdiffr", "vegan"))
install.packages(c("caret", "cluster", "cpp11", "data.table", "effectsize", "emmeans", "expm", "fBasics", "gdtools", "gert", "gmp", "gss", "hexbin", "Hmisc", "igraph", "jqr", "lubridate", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "np", "parallelly", "pcaPP", "phangorn", "PMCMRplus", "qs", "quantreg", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "Rmpfr", "robustbase", "rrcov", "RSpectra", "rsvg", "sf", "sodium", "SparseM", "terra", "testthat", "textshaping", "vdiffr", "vegan"))
install.packages(c("ape", "BH", "expm", "fBasics", "gdtools", "gert", "gmp", "gower", "gss", "hexbin", "Hmisc", "igraph", "jqr", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "openssl", "pcaPP", "phangorn", "pillar", "PMCMRplus", "qs", "quantreg", "ragg", "randomForest", "RcppArmadillo", "RcppEigen", "Rmpfr", "robustbase", "rrcov", "Rserve", "RSpectra", "rsvg", "sf", "shiny", "sodium", "SparseM", "survival", "terra", "textshaping", "vdiffr", "vegan"))
install.packages(c("ape", "bayestestR", "bit64", "bookdown", "broom.helpers", "class", "classInt", "clock", "curl", "datawizard", "dbscan", "doRNG", "evaluate", "expm", "fastDummies", "fastmatch", "fBasics", "foreign", "gdtools", "gert", "ggeffects", "ggstats", "gmp", "graphlayouts", "gss", "hexbin", "Hmisc", "hoardr", "httr2", "igraph", "inline", "insight", "janitor", "jqr", "KernSmooth", "labelled", "lava", "lme4", "matrixStats", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "nnet", "openssl", "parallelly", "parameters", "pcaPP", "performance", "phangorn", "phytools", "pillar", "pkgbuild", "PMCMRplus", "processx", "qs", "quantreg", "ragg", "randomForest", "raster", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "RcppThread", "Rfast", "rgl", "rlang", "Rmpfr", "robustbase", "rpart", "rrcov", "RSpectra", "rsvg", "sf", "shapviz", "sodium", "SparseM", "spatial", "systemfonts", "terra", "testthat", "textshaping", "vdiffr", "vegan", "xfun", "XML", "yardstick"))
install.packages("DescTools")
install.packages("DescTools")
install.packages(c("ape", "classInt", "expm", "fBasics", "gdtools", "gert", "ggeffects", "gmp", "gss", "hexbin", "Hmisc", "igraph", "insight", "jqr", "KernSmooth", "minqa", "mvtnorm", "ncdf4", "nlme", "nloptr", "pcaPP", "phangorn", "PMCMRplus", "purrr", "qs", "quantreg", "ragg", "randomForest", "raster", "RcppArmadillo", "RcppEigen", "Rfast", "Rmpfr", "robustbase", "rrcov", "RSpectra", "rsvg", "sessioninfo", "sf", "sodium", "SparseM", "systemfonts", "terra", "textshaping", "vdiffr", "vegan"))
setwd("~/OneDrive - University of California, San Diego Health/Projects/Caltech/Data/mice_antibiotics")
library(tidyverse)
library(ggpubr)
library(vegan)
library(patchwork)
library(rstatix)
# Read data and metadata
data <- read_csv("mzmine/gnps_quant.csv")
meta <- read.delim("metadata/R_HAN_01.05_Samplemetadata.txt")
meta <- meta %>% dplyr::mutate(filename = gsub(".mzXML", "", filename))
# Data tables
data_mice <- data %>%
column_to_rownames("row ID") %>% dplyr::select(contains("Peak")) %>%
t() %>% as.data.frame() %>% rownames_to_column("SampleID") %>%
arrange(SampleID) %>% distinct(SampleID, .keep_all = TRUE)
data_mice$SampleID <- gsub(".mzXML Peak area", "", data_mice$SampleID)
# Check TIC
data_TIC <- data.frame(TIC = rowSums(data_mice %>% column_to_rownames("SampleID"))) %>%
rownames_to_column("SampleID") %>% arrange(TIC) %>%
dplyr::mutate(Type = case_when(str_detect(pattern = "blank", SampleID) ~ "Blank",
str_detect(pattern = "CQ", SampleID) ~ "QC",
TRUE ~ "Sample"))
data_TIC %>%
dplyr::mutate(Order = seq_len(n())) %>% # fake order
ggscatter("Order", "TIC", add = "reg.line", color = "Type")
# Remove sample with low or high TIC
sample_filter <- data_TIC %>% dplyr::filter(Type == "Sample") %>%
dplyr::filter(TIC > 3e9)
Q1 <- quantile(sample_filter$TIC, 0.25)
Q3 <- quantile(sample_filter$TIC, 0.75)
IQR <- Q3 - Q1
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR
sample_final <- sample_filter %>%
dplyr::filter(TIC >= lower_bound & TIC <= upper_bound)
View(data_mice)
View(data_TIC)
View(data_mice)
View(data)
# Check carnitines --> (9657 - m/z 280.1545 and 10843 - m/z 294.1703 and 9300 - m/z 266.139)
carnitines <- data_mice %>% dplyr::filter(SampleID %in% sample_final$SampleID) %>%
dplyr::select("SampleID", "9657", "10843", "9300")
# plot 280
plot_280 <- carnitines %>% left_join(meta, by = c("SampleID" = "filename")) %>%
dplyr::mutate(LogMol = log(`9657` + 1)) %>%
ggboxplot(x = "ATTRIBUTE_Traitement", y = "LogMol", add = "jitter",
xlab = FALSE, title = "m/z 280.154", ylab = "Log(Peak Area)",
add.params = list(color = "ATTRIBUTE_Traitement", alpha = 0.5), legend = "none",
palette = c("#214d65", "#E5BF86", "#287DAB")) + ylim(0,15)  +
theme(plot.title = element_text(size = 10), axis.title = element_text(size = 6),
axis.text = element_text(size = 8))
# plot 294
plot_294 <- carnitines %>% left_join(meta, by = c("SampleID" = "filename")) %>%
dplyr::mutate(LogMol = log(`10843` + 1)) %>%
ggboxplot(x = "ATTRIBUTE_Traitement", y = "LogMol", add = "jitter",
xlab = FALSE, title = "m/z 294.170", ylab = "Log(Peak Area)",
add.params = list(color = "ATTRIBUTE_Traitement", alpha = 0.5), legend = "none",
palette = c("#214d65", "#E5BF86", "#287DAB")) + ylim(0,15)  +
theme(plot.title = element_text(size = 10), axis.title = element_text(size = 6),
axis.text = element_text(size = 8))
# plot 266
plot_266 <- carnitines %>% left_join(meta, by = c("SampleID" = "filename")) %>%
dplyr::mutate(LogMol = log(`9300` + 1)) %>%
ggboxplot(x = "ATTRIBUTE_Traitement", y = "LogMol", add = "jitter",
xlab = FALSE, title = "m/z 266.139", ylab = "Log(Peak Area)",
add.params = list(color = "ATTRIBUTE_Traitement", alpha = 0.5), legend = "none",
palette = c("#214d65", "#E5BF86", "#287DAB")) + ylim(0,15)  +
theme(plot.title = element_text(size = 10), axis.title = element_text(size = 6),
axis.text = element_text(size = 8))
plot_266
# Combined plots
plot_carn <- ggarrange(plot_280, plot_294, plot_266, nrow = 1)
plot_carn
carnitines %>% left_join(meta, by = c("SampleID" = "filename")) %>%
dplyr::mutate(LogMol = log(`9300` + 1)) %>%
pairwise_wilcox_test(formula = LogMol ~ ATTRIBUTE_Traitement)
# Combined plots
plot_carn <- ggarrange(plot_266, plot_280, plot_294, nrow = 1)
plot_carn
